define(["block_aipromptgen/markdown"],(function(t){return{startStream:function(e,n,o,r,a){if(!window.EventSource){const t=e();return void(t&&t.submit())}const i=document.querySelector("input[name=courseid]"),c=i&&i.value||"";o.value="ollama";const d=function(t){const e="ai-response-status";let n=document.getElementById(e);n||(n=document.createElement("div"),n.id=e,n.className="small text-muted",t&&t.parentNode&&t.parentNode.insertBefore(n,t)),n&&(n.textContent="Streaming...");const o=document.getElementById("ai4t-airesponse-modal"),r=document.getElementById("ai4t-modal-backdrop");return r&&(r.style.display="block"),o&&(o.style.display="block"),t&&(t.textContent="",t.setAttribute("aria-busy","true")),n}(r),s=(window.M&&window.M.cfg&&window.M.cfg.wwwroot?window.M.cfg.wwwroot:"")+"/blocks/aipromptgen/stream.php";let u=n.value||n.textContent||"";if(!u){const t=e(),n=new FormData(t||void 0);u="Topic: "+(n.get("topic")||"")+"\nLesson: "+(n.get("lesson")||"")+"\nOutcomes: "+(n.get("outcomes")||"")}const l=new EventSource(s+"?courseid="+encodeURIComponent(c)+"&provider=ollama&prompt="+encodeURIComponent(u));let m=Date.now();const w=setInterval((function(){Date.now()-m>3e4&&(d&&(d.textContent="Timeout (incomplete)"),r&&r.removeAttribute("aria-busy"),l.close(),clearInterval(w),a())}),2e3);l.addEventListener("chunk",(function(){m=Date.now()})),l.addEventListener("done",(function(){clearInterval(w)})),l.addEventListener("error",(function(){clearInterval(w)})),function(e,n,o,r){let a=!0;e.addEventListener("start",(function(){o&&(o.textContent="Started"),r()})),e.addEventListener("chunk",(function(t){n&&(n.textContent+=t.data,a&&(r(),a=!1))})),e.addEventListener("error",(function(t){n&&(n.textContent+="\n[Error] "+(t.data||"")),o&&(o.textContent="Error"),r()})),e.addEventListener("done",(function(){o&&(o.textContent="Done"),n&&(n.removeAttribute("aria-busy"),n.textContent=t.autofixMarkdown(n.textContent)),r(),e.close()}))}(l,r,d,a)}}}));
//# sourceMappingURL=stream.min.js.map