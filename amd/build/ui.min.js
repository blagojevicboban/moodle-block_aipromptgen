define([],(function(){return{init:function(){require(["block_aipromptgen/age","block_aipromptgen/pickers","block_aipromptgen/actions","block_aipromptgen/stream","block_aipromptgen/markdown"],(function(e,t,n,o,i){var a=function(){var e=function(e){var t=document.getElementById(e);return t?t.value:""},t=e("id_subject");if(!t){var n=document.getElementById("id_subject");n&&n.placeholder&&(t=n.placeholder)}var o=e("id_agerange"),i=e("id_topic"),a=e("id_lesson"),d=e("id_lessoncount")||"1",c=e("id_lessonduration")||"45",s=e("id_classtype"),l=e("id_purpose"),r=e("id_audience"),m=e("id_outcomes"),u="You are an expert teacher. Create a detailed lesson plan.\n";u+="Subject: "+t+"\n",o&&(u+="Student Age: "+o+" years old\n"),i&&(u+="Topic: "+i+"\n"),a&&(u+="Lesson Title: "+a+"\n"),u+="Number of lessons: "+d+"\n",u+="Duration per lesson: "+c+" minutes\n",s&&(u+="Class Type: "+s+"\n"),l&&(u+="Purpose: "+l+"\n"),r&&(u+="Target Audience: "+r+"\n"),m&&(u+="Learning Outcomes/Competencies:\n"+m+"\n"),u+="Language: "+(e("id_language")||"English")+"\n",u+="\nPlease provide a structured lesson plan with objectives, activities, and timeline.";var p=document.getElementById("ai4t-generated");p&&(p.value=u,p.dispatchEvent(new Event("input",{bubbles:!0})))},d=function(e,t,n,o,i,a,d,c){var s={raw:0,text:1,html:2,rich:3}[e];if(t[s]&&(t[s].classList.remove("btn-outline-secondary"),t[s].classList.add("btn-secondary")),"raw"===e&&o)o.style.display="block";else if("text"===e&&i)i.style.display="block",i.textContent=c.renderText(o.textContent);else if("html"===e&&a)a.style.display="block",a.textContent=c.renderMarkdown(o.textContent);else if("rich"===e&&d){d.style.display="block";try{d.innerHTML=c.renderMarkdown(o.textContent)}catch(e){d.innerHTML="<p>Error rendering Markdown.</p>"}}},c=function(e,t,n,o){var i=e.target.closest("button"),a=e.target;i&&("ai4t-btn-raw"===i.id?o.setView("raw"):"ai4t-btn-text"===i.id?o.setView("text"):"ai4t-btn-html"===i.id?o.setView("html"):"ai4t-btn-rich"===i.id?o.setView("rich"):"ai4t-airesponse-modal-close-btn"===i.id?(t.style.display="none",n&&(n.style.display="none")):"ai4t-airesponse-modal-copy-btn"===i.id?s(o):"ai4t-airesponse-modal-insert-btn"===i.id&&r(o,t,n)),a&&"ai4t-airesponse-modal-close"===a.id&&(t.style.display="none",n&&(n.style.display="none"))},s=function(e){if(e.bodyHtml&&"none"!==e.bodyHtml.style.display)e.copyRichText(e.bodyHtml)?e.showStatus("Copied as Rich Text!"):e.showStatus("Copy failed");else{var t="";if(e.bodyRaw&&"none"!==e.bodyRaw.style.display?t=e.bodyRaw.textContent:e.bodyText&&"none"!==e.bodyText.style.display?t=e.bodyText.textContent:e.bodyCode&&"none"!==e.bodyCode.style.display&&(t=e.bodyCode.textContent),navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(t).then((function(){e.showStatus("Copied to clipboard!")})).catch((function(){}));else{var n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),e.showStatus("Copied!")}}},l=function(e){var t=document.getElementById("ai4t-modal-copy-status");t?(t.textContent=e,t.style.display="inline",setTimeout((function(){t.style.display="none"}),2e3)):window.console.log(e)},r=function(){},m=function(e){try{var t=document.createRange();t.selectNode(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t);var o=document.execCommand("copy");return n.removeAllRanges(),o}catch(e){return!1}};[function(){e.initAgeModal()},function(){t.attachPicker({openId:"ai4t-lesson-browse",modalId:"ai4t-modal",closeId:"ai4t-modal-close",cancelId:"ai4t-modal-cancel",itemSelector:".ai4t-lesson-item",targetId:"id_lesson"}),t.attachPicker({openId:"ai4t-topic-browse",modalId:"ai4t-topic-modal",closeId:"ai4t-topic-modal-close",cancelId:"ai4t-topic-modal-cancel",itemSelector:".ai4t-topic-item",targetId:"id_topic"}),t.attachOutcomesModal(),t.initLanguageModal(),["purpose","audience","classtype"].forEach((function(e){t.attachPicker({openId:"ai4t-"+e+"-browse",modalId:"ai4t-"+e+"-modal",closeId:"ai4t-"+e+"-modal-close",cancelId:"ai4t-"+e+"-modal-cancel",itemSelector:".ai4t-"+e+"-item",targetId:"id_"+e})}))},function(){n.attachCopyDownload()},function(){!function(){var e=document.getElementById("ai4t-sendtoai"),t=document.getElementById("ai4t-provider"),n=document.getElementById("ai4t-generated"),i=document.getElementById("ai4t-sendto");if(!i&&e){var a=document.getElementById("mform1")||document.getElementById("promptform")||e.closest("form");a&&((i=document.createElement("input")).type="hidden",i.name="sendto",i.id="ai4t-sendto",a.appendChild(i))}if(e&&t&&n){var d=function(){var o=t.options[t.selectedIndex],i=o&&/âœ•\s*$/.test(o.textContent||"");e.disabled=!n.value.trim()||i};t.addEventListener("change",d),n.addEventListener("input",d),e.addEventListener("click",(function(a){if(!e.disabled){var d=t.value,c=document.getElementById("ai4t-send-form");if("ollama"!==d)i.value=d,c&&c.submit();else{a.preventDefault();var s=document.getElementById("ai4t-airesponse-body")||document.getElementById("ai4t-airesponse");o.startStream((function(){return c}),n,i,s,(function(){}))}}})),d()}}()},function(){["id_subject","id_agerange","id_topic","id_lesson","id_lessoncount","id_lessonduration","id_classtype","id_purpose","id_audience","id_outcomes","id_language"].forEach((function(e){var t=document.getElementById(e);t&&(t.addEventListener("input",a),t.addEventListener("change",a))})),setTimeout(a,500)},function(){!function(){var e=document.getElementById("ai4t-airesponse-modal");if(e){var t=document.getElementById("ai4t-airesponse-body"),n=document.getElementById("ai4t-airesponse-text"),o=document.getElementById("ai4t-airesponse-html"),a=document.getElementById("ai4t-airesponse-code"),s=document.getElementById("ai4t-modal-backdrop"),r=function(e){var c=["raw","text","html","rich"].map((function(e){return document.getElementById("ai4t-btn-"+e)})),s=[t,n,o,a];c.forEach((function(e){e&&(e.classList.remove("btn-secondary"),e.classList.add("btn-outline-secondary"))})),s.forEach((function(e){e&&(e.style.display="none")})),d(e,c,s,t,n,a,o,i)};document.addEventListener("aipromptgen:open",(function(){var e=document.querySelector(".block_aipromptgen");if(e)e.scrollIntoView({behavior:"smooth"}),e.style.border="2px solid #007bff",setTimeout((function(){e.style.border=""}),2e3);else if(window.M&&window.M.cfg&&window.M.cfg.wwwroot){var t="1";window.M.cfg.courseId&&(t=window.M.cfg.courseId);var n=window.M.cfg.wwwroot+"/blocks/aipromptgen/view.php?courseid="+t;window.open(n,"aipromptgen","width=800,height=800,scrollbars=yes,resizable=yes")}})),document.addEventListener("click",(function(i){c(i,e,s,{bodyRaw:t,bodyText:n,bodyHtml:o,bodyCode:a,setView:r,showStatus:l,copyRichText:m})})),t&&t.textContent.trim().length>0&&(e.style.display="block",s&&(s.style.display="block"),r("rich"))}}()}].forEach((function(e){try{e()}catch(e){}}))}))}}}));
//# sourceMappingURL=ui.min.js.map